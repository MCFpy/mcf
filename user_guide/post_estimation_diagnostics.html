
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>6. Post-estimation diagnostics &#8212; mcf 0.9.0  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'user_guide/post_estimation_diagnostics';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="7. Experimental features" href="experimental_features.html" />
    <link rel="prev" title="5. Feature selection" href="feature_selection.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">mcf 0.9.0  documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting_started.html">
    Getting started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../user_guide.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../algorithm_reference.html">
    Algorithm Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../python_api.html">
    Python API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../FAQ.html">
    FAQ
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../changelog.html">
    Changelog
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/MCFpy/mcf" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/mcf/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting_started.html">
    Getting started
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../user_guide.html">
    User Guide
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../algorithm_reference.html">
    Algorithm Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../python_api.html">
    Python API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../FAQ.html">
    FAQ
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../changelog.html">
    Changelog
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/MCFpy/mcf" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/mcf/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../user_guide.html" class="nav-link">User Guide</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis"><span class="section-number">6. </span>Post-estimation diagnostics</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="post-estimation-diagnostics">
<h1><span class="section-number">6. </span>Post-estimation diagnostics<a class="headerlink" href="#post-estimation-diagnostics" title="Link to this heading">#</a></h1>
<p>The class <a class="reference internal" href="../python_api.html#mcf_main.ModifiedCausalForest" title="mcf_main.ModifiedCausalForest"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModifiedCausalForest</span></code></a> provides you with several diagnostic tools to analyse the estimated <span class="math notranslate nohighlight">\(\text{IATE's}\)</span>. They cover</p>
<ul class="simple">
<li><p>descriptive statistics</p></li>
<li><p>a correlation analysis</p></li>
<li><p><span class="math notranslate nohighlight">\(k\)</span>-means clustering</p></li>
<li><p>a feature importance analysis</p></li>
</ul>
<p>To conduct <em>any</em> post-estimation diagnostics, the parameter <code class="docutils literal notranslate"><span class="pre">post_est_stats</span></code> of the class <a class="reference internal" href="../python_api.html#mcf_main.ModifiedCausalForest" title="mcf_main.ModifiedCausalForest"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModifiedCausalForest</span></code></a> needs to be set to True. Once you have estimated your <span class="math notranslate nohighlight">\(\text{IATE's}\)</span> using the <a class="reference internal" href="../mcf_main.ModifiedCausalForest.predict.html#mcf_main.ModifiedCausalForest.predict" title="mcf_main.ModifiedCausalForest.predict"><code class="xref py py-meth docutils literal notranslate"><span class="pre">predict()</span></code></a> method, you can conduct the post-estimation diagnostics with the <a class="reference internal" href="../mcf_main.ModifiedCausalForest.analyse.html#mcf_main.ModifiedCausalForest.analyse" title="mcf_main.ModifiedCausalForest.analyse"><code class="xref py py-meth docutils literal notranslate"><span class="pre">analyse()</span></code></a> method:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mcf.example_data_functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">example_data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mcf.mcf_main</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModifiedCausalForest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mcf.reporting</span><span class="w"> </span><span class="kn">import</span> <span class="n">McfOptPolReport</span>

<span class="c1"># Generate example data using the built-in function `example_data()`</span>
<span class="n">training_df</span><span class="p">,</span> <span class="n">prediction_df</span><span class="p">,</span> <span class="n">name_dict</span> <span class="o">=</span> <span class="n">example_data</span><span class="p">()</span>


<span class="n">my_mcf</span> <span class="o">=</span> <span class="n">ModifiedCausalForest</span><span class="p">(</span>
        <span class="n">var_y_name</span><span class="o">=</span><span class="s2">&quot;outcome&quot;</span><span class="p">,</span>
        <span class="n">var_d_name</span><span class="o">=</span><span class="s2">&quot;treat&quot;</span><span class="p">,</span>
        <span class="n">var_x_name_ord</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x_cont0&quot;</span><span class="p">,</span> <span class="s2">&quot;x_cont1&quot;</span><span class="p">,</span> <span class="s2">&quot;x_ord1&quot;</span><span class="p">],</span>
        <span class="n">var_x_name_unord</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x_unord0&quot;</span><span class="p">],</span>
        <span class="c1"># Enable post-estimation diagnostics</span>
        <span class="n">post_est_stats</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

<span class="n">my_mcf</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_df</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">my_mcf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">prediction_df</span><span class="p">)</span>

<span class="n">post_estimation_diagnostics</span> <span class="o">=</span> <span class="n">my_mcf</span><span class="o">.</span><span class="n">analyse</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
<p>The easiest way to to inspect the results of the post-estimation diagnostics, is to read the PDF-report that can be generated using the class <a class="reference internal" href="../python_api.html#reporting.McfOptPolReport" title="reporting.McfOptPolReport"><code class="xref py py-class docutils literal notranslate"><span class="pre">McfOptPolReport</span></code></a>:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mcf_report</span> <span class="o">=</span> <span class="n">McfOptPolReport</span><span class="p">(</span><span class="n">mcf</span><span class="o">=</span><span class="n">my_mcf</span><span class="p">,</span> <span class="n">outputfile</span><span class="o">=</span><span class="s1">&#39;Modified-Causal-Forest_Report&#39;</span><span class="p">)</span>
<span class="n">mcf_report</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
</pre></div>
</div>
<p>You can additionally specify the reference group for the <span class="math notranslate nohighlight">\(\text{IATE's}\)</span> with the parameter <code class="docutils literal notranslate"><span class="pre">post_relative_to_first_group_only</span></code>. If <code class="docutils literal notranslate"><span class="pre">post_relative_to_first_group_only</span></code> is True, the comparison group will be the first treatment state. This is the default. If False, all possible treatment combinations are compared with each other. The confidence level in the post-estimation diagnostics is specified through the parameter <code class="docutils literal notranslate"><span class="pre">p_ci_level</span></code>.</p>
<section id="descriptive-statistics">
<h2><span class="section-number">6.1. </span>Descriptive statistics<a class="headerlink" href="#descriptive-statistics" title="Link to this heading">#</a></h2>
<p>With <code class="docutils literal notranslate"><span class="pre">post_est_stats</span></code> set to True, the distribution of the estimated <span class="math notranslate nohighlight">\(\text{IATE's}\)</span> will be presented. The produced plots are also available in the output folder that is produced by the <strong>mcf</strong> package. You can find the location of this folder by accessing the <cite>“outpath”</cite> entry of the <cite>gen_dict</cite> attribute of your Modified Causal Forest:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">my_mcf</span><span class="o">.</span><span class="n">gen_cfg</span><span class="o">.</span><span class="n">outpath</span>
</pre></div>
</div>
<p>You can also specify this path through the <code class="docutils literal notranslate"><span class="pre">gen_outpath</span></code> parameter of the class <a class="reference internal" href="../python_api.html#mcf_main.ModifiedCausalForest" title="mcf_main.ModifiedCausalForest"><code class="xref py py-meth docutils literal notranslate"><span class="pre">ModifiedCausalForest()</span></code></a>. The output folder will contain the jpeg/pdf-files of the plots as well as csv-files of the underlying data in the subfolder <cite>ate_iate</cite>.</p>
</section>
<section id="correlation-analysis">
<h2><span class="section-number">6.2. </span>Correlation analysis<a class="headerlink" href="#correlation-analysis" title="Link to this heading">#</a></h2>
<p>The correlation analysis estimates the dependencies between the different <span class="math notranslate nohighlight">\(\text{IATE's}\)</span>, between the <span class="math notranslate nohighlight">\(\text{IATE's}\)</span> and the potential outcomes, and between the <span class="math notranslate nohighlight">\(\text{IATE's}\)</span> and the features. You can activate the correlation analysis by setting the parameter <code class="docutils literal notranslate"><span class="pre">post_bin_corr_yes</span></code> to True. Note that the correlation coefficients are only displayed if their absolute values exceed the threshold specified by the parameter <code class="docutils literal notranslate"><span class="pre">post_bin_corr_threshold</span></code>.</p>
</section>
<section id="k-means-clustering">
<h2><span class="section-number">6.3. </span><span class="math notranslate nohighlight">\(k\)</span>-means clustering<a class="headerlink" href="#k-means-clustering" title="Link to this heading">#</a></h2>
<p>To analyze heterogeneity in different groups (clusters), you can conduct <span class="math notranslate nohighlight">\(k\)</span>-means clustering by setting the parameter <code class="docutils literal notranslate"><span class="pre">post_kmeans_yes</span></code> to <em>True</em>. The <strong>mcf</strong> package uses the <em>k-means++</em> algorithm from scikit-learn to build clusters based on the <span class="math notranslate nohighlight">\(\text{IATE's}\)</span>.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mcf.example_data_functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">example_data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mcf.mcf_main</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModifiedCausalForest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mcf.reporting</span><span class="w"> </span><span class="kn">import</span> <span class="n">McfOptPolReport</span>

<span class="c1"># Generate example data using the built-in function `example_data()`</span>
<span class="n">training_df</span><span class="p">,</span> <span class="n">prediction_df</span><span class="p">,</span> <span class="n">name_dict</span> <span class="o">=</span> <span class="n">example_data</span><span class="p">()</span>

<span class="n">my_mcf</span> <span class="o">=</span> <span class="n">ModifiedCausalForest</span><span class="p">(</span>
        <span class="n">var_y_name</span><span class="o">=</span><span class="s2">&quot;outcome&quot;</span><span class="p">,</span>
        <span class="n">var_d_name</span><span class="o">=</span><span class="s2">&quot;treat&quot;</span><span class="p">,</span>
        <span class="n">var_x_name_ord</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x_cont0&quot;</span><span class="p">,</span> <span class="s2">&quot;x_cont1&quot;</span><span class="p">,</span> <span class="s2">&quot;x_ord1&quot;</span><span class="p">],</span>
        <span class="n">var_x_name_unord</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x_unord0&quot;</span><span class="p">],</span>
        <span class="n">post_est_stats</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="c1"># Perform k-means clustering</span>
        <span class="n">post_kmeans_yes</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

<span class="n">my_mcf</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_df</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">my_mcf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">prediction_df</span><span class="p">)</span>

<span class="n">post_estimation_diagnostics</span> <span class="o">=</span> <span class="n">my_mcf</span><span class="o">.</span><span class="n">analyse</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</pre></div>
</div>
<p>The report obtained through the class <a class="reference internal" href="../python_api.html#reporting.McfOptPolReport" title="reporting.McfOptPolReport"><code class="xref py py-class docutils literal notranslate"><span class="pre">McfOptPolReport</span></code></a> will contain descriptive statistics of the <span class="math notranslate nohighlight">\(\text{IATE's}\)</span>, the potential outcomes and the features for each cluster.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">mcf_report</span> <span class="o">=</span> <span class="n">McfOptPolReport</span><span class="p">(</span><span class="n">mcf</span><span class="o">=</span><span class="n">my_mcf</span><span class="p">,</span> <span class="n">outputfile</span><span class="o">=</span><span class="s1">&#39;Modified-Causal-Forest_Report&#39;</span><span class="p">)</span>
<span class="n">mcf_report</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
</pre></div>
</div>
<p>If you wish to analyse the clusters yourself, you can access the cluster membership of each observation through the <em>“iate_data_df”</em> entry of the dictionary returned by the <a class="reference internal" href="../mcf_main.ModifiedCausalForest.analyse.html#mcf_main.ModifiedCausalForest.analyse" title="mcf_main.ModifiedCausalForest.analyse"><code class="xref py py-meth docutils literal notranslate"><span class="pre">analyse()</span></code></a> method. The cluster membership is stored in the column <em>IATE_Cluster</em> of the DataFrame.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">post_estimation_diagnostics</span><span class="p">[</span><span class="s2">&quot;iate_data_df&quot;</span><span class="p">]</span>
</pre></div>
</div>
<p>You can define a range for the number of clusters through the parameter <code class="docutils literal notranslate"><span class="pre">post_kmeans_no_of_groups</span></code>. The final number of clusters is chosen via silhouette analysis. To guard against getting stuck at local extrema, the number of replications with different random start centers can be defined through the parameter <code class="docutils literal notranslate"><span class="pre">post_kmeans_replications</span></code>. The parameter <code class="docutils literal notranslate"><span class="pre">post_kmeans_max_tries</span></code> sets the maximum number of iterations in each replication to achieve convergence.</p>
</section>
<section id="feature-importance">
<h2><span class="section-number">6.4. </span>Feature importance<a class="headerlink" href="#feature-importance" title="Link to this heading">#</a></h2>
<p>If you are interested in learning which of your features have a lot of predictive power for the estimated <span class="math notranslate nohighlight">\(\text{IATE's}\)</span> you can activate the feature importance procedure by setting the parameter <code class="docutils literal notranslate"><span class="pre">post_random_forest_vi</span></code> to True. This procedure will build a predictive random forest to determine which features influence the <span class="math notranslate nohighlight">\(\text{IATE's}\)</span> most. The feature importance statistics are presented in percentage points of the coefficient of determination, <span class="math notranslate nohighlight">\(R^2\)</span>, that is lost when the respective feature is randomly permuted. The <span class="math notranslate nohighlight">\(R^2\)</span> statistics are obtained through the <em>RandomForestRegressor</em> provided by scikit-learn.</p>
</section>
<section id="parameter-overview">
<h2><span class="section-number">6.5. </span>Parameter overview<a class="headerlink" href="#parameter-overview" title="Link to this heading">#</a></h2>
<p>Below is an overview of the above mentioned parameters related to post-estimation diagnostics in the class <a class="reference internal" href="../python_api.html#mcf_main.ModifiedCausalForest" title="mcf_main.ModifiedCausalForest"><code class="xref py py-class docutils literal notranslate"><span class="pre">ModifiedCausalForest</span></code></a>:</p>
<p>Please consult the <a class="reference internal" href="../python_api.html#mcf_main.ModifiedCausalForest" title="mcf_main.ModifiedCausalForest"><code class="xref py py-class docutils literal notranslate"><span class="pre">API</span></code></a> for more details.</p>
</section>
<section id="example">
<h2><span class="section-number">6.6. </span>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mcf.example_data_functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">example_data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mcf.mcf_main</span><span class="w"> </span><span class="kn">import</span> <span class="n">ModifiedCausalForest</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mcf.reporting</span><span class="w"> </span><span class="kn">import</span> <span class="n">McfOptPolReport</span>

<span class="c1"># Generate example data using the built-in function `example_data()`</span>
<span class="n">training_df</span><span class="p">,</span> <span class="n">prediction_df</span><span class="p">,</span> <span class="n">name_dict</span> <span class="o">=</span> <span class="n">example_data</span><span class="p">()</span>

<span class="n">my_mcf</span> <span class="o">=</span> <span class="n">ModifiedCausalForest</span><span class="p">(</span>
        <span class="n">var_y_name</span><span class="o">=</span><span class="s2">&quot;outcome&quot;</span><span class="p">,</span>
        <span class="n">var_d_name</span><span class="o">=</span><span class="s2">&quot;treat&quot;</span><span class="p">,</span>
        <span class="n">var_x_name_ord</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x_cont0&quot;</span><span class="p">,</span> <span class="s2">&quot;x_cont1&quot;</span><span class="p">,</span> <span class="s2">&quot;x_ord1&quot;</span><span class="p">],</span>
        <span class="n">var_x_name_unord</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;x_unord0&quot;</span><span class="p">],</span>
        <span class="n">p_ci_level</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
        <span class="c1"># Parameters for post-estimation diagnostics</span>
        <span class="n">post_est_stats</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">post_relative_to_first_group_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">post_bin_corr_yes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">post_bin_corr_threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span>
        <span class="n">post_kmeans_yes</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">post_kmeans_no_of_groups</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span>
        <span class="n">post_kmeans_max_tries</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
        <span class="n">post_kmeans_replications</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
        <span class="n">post_random_forest_vi</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">post_plots</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="n">post_kmeans_min_size_share</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">post_tree</span><span class="o">=</span><span class="kc">True</span>
    <span class="p">)</span>

<span class="n">my_mcf</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">training_df</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">my_mcf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">prediction_df</span><span class="p">)</span>

<span class="c1"># Compute the post-estimation diagnostics</span>
<span class="n">post_estimation_diagnostics</span> <span class="o">=</span> <span class="n">my_mcf</span><span class="o">.</span><span class="n">analyse</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>

<span class="c1"># Access cluster memberships (column &#39;IATE_Cluster&#39;)</span>
<span class="n">post_estimation_diagnostics</span><span class="p">[</span><span class="s2">&quot;iate_data_df&quot;</span><span class="p">]</span>

<span class="c1"># Produce a PDF-report with the results, including post-estimation diagnostics</span>
<span class="n">mcf_report</span> <span class="o">=</span> <span class="n">McfOptPolReport</span><span class="p">(</span><span class="n">mcf</span><span class="o">=</span><span class="n">my_mcf</span><span class="p">,</span> <span class="n">outputfile</span><span class="o">=</span><span class="s1">&#39;Modified-Causal-Forest_Report&#39;</span><span class="p">)</span>
<span class="n">mcf_report</span><span class="o">.</span><span class="n">report</span><span class="p">()</span>
</pre></div>
</div>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="feature_selection.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5. </span>Feature selection</p>
      </div>
    </a>
    <a class="right-next"
       href="experimental_features.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">7. </span>Experimental features</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#descriptive-statistics">6.1. Descriptive statistics</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#correlation-analysis">6.2. Correlation analysis</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#k-means-clustering">6.3. <span class="math notranslate nohighlight">\(k\)</span>-means clustering</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#feature-importance">6.4. Feature importance</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-overview">6.5. Parameter overview</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#example">6.6. Example</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/user_guide/post_estimation_diagnostics.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      © Copyright 2024, Michael Lechner.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>