
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>1. Optimal Policy Allocation &#8212; mcf 0.9.0  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=8f2a1f02" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'algorithm_reference/optimal-policy_algorithm';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="2. Fairness Extensions in Optimal Policy" href="fairscores.html" />
    <link rel="prev" title="5. QIATEs" href="QIATEs.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
<div class="bd-header__inner bd-page-width">
  <button class="pst-navbar-icon sidebar-toggle primary-toggle" aria-label="Site navigation">
    <span class="fa-solid fa-bars"></span>
  </button>
  
  
  <div class="col-lg-3 navbar-header-items__start">
    
      <div class="navbar-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
  
    <p class="title logo__title">mcf 0.9.0  documentation</p>
  
</a></div>
    
  </div>
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting_started.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide.html">
    User Guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../algorithm_reference.html">
    Algorithm Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../python_api.html">
    Python API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../FAQ.html">
    FAQ
  </a>
</li>

            <li class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button"
                data-bs-toggle="dropdown" aria-expanded="false"
                aria-controls="pst-nav-more-links">
                    More
                </button>
                <ul id="pst-nav-more-links" class="dropdown-menu">
                    
<li class=" ">
  <a class="nav-link dropdown-item nav-internal" href="../changelog.html">
    Changelog
  </a>
</li>

                </ul>
            </li>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
        </div>
      
      
        <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
      
        <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/MCFpy/mcf" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/mcf/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button>
    </div>
  

  
    <button class="pst-navbar-icon sidebar-toggle secondary-toggle" aria-label="On this page">
      <span class="fa-solid fa-outdent"></span>
    </button>
  
</div>

    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          
          
            <div class="navbar-item">
<nav>
  <ul class="bd-navbar-elements navbar-nav">
    
<li class="nav-item ">
  <a class="nav-link nav-internal" href="../getting_started.html">
    Getting started
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../user_guide.html">
    User Guide
  </a>
</li>


<li class="nav-item current active">
  <a class="nav-link nav-internal" href="../algorithm_reference.html">
    Algorithm Reference
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../python_api.html">
    Python API
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../FAQ.html">
    FAQ
  </a>
</li>


<li class="nav-item ">
  <a class="nav-link nav-internal" href="../changelog.html">
    Changelog
  </a>
</li>

  </ul>
</nav></div>
          
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">

<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button></div>
        
          <div class="navbar-item"><ul class="navbar-icon-links"
    aria-label="Icon Links">
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://github.com/MCFpy/mcf" title="GitHub" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-square-github fa-lg" aria-hidden="true"></i>
            <span class="sr-only">GitHub</span></a>
        </li>
        <li class="nav-item">
          
          
          
          
          
          
          
          
          <a href="https://pypi.org/project/mcf/" title="PyPI" class="nav-link pst-navbar-icon" rel="noopener" target="_blank" data-bs-toggle="tooltip" data-bs-placement="bottom"><i class="fa-brands fa-python fa-lg" aria-hidden="true"></i>
            <span class="sr-only">PyPI</span></a>
        </li>
</ul></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">

<nav aria-label="Breadcrumb" class="d-print-none">
  <ul class="bd-breadcrumbs">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="../algorithm_reference.html" class="nav-link">Algorithm Reference</a></li>
    
    <li class="breadcrumb-item active" aria-current="page"><span class="ellipsis"><span class="section-number">1. </span>Optimal Policy Allocation</span></li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section id="optimal-policy-allocation">
<h1><span class="section-number">1. </span>Optimal Policy Allocation<a class="headerlink" href="#optimal-policy-allocation" title="Link to this heading">#</a></h1>
<p>The evaluation of the IATEs makes it possible to detect potential heterogeneous effects across sub-groups of the population.
If heterogeneity is observed, certain individuals may either benefit or not from a particular treatment.
To address this, the mcf introduces the <a class="reference internal" href="../python_api.html#optpolicy_main.OptimalPolicy" title="optpolicy_main.OptimalPolicy"><code class="xref py py-class docutils literal notranslate"><span class="pre">OptimalPolicy</span></code></a> class.</p>
<p>To determine an optimal policy allocation, you can choose between three methods:</p>
<ul class="simple">
<li><p><strong>Policy Tree</strong>: This method bases on a tree-search algorithm, designed to construct an optimal policy tree.</p></li>
<li><p><strong>Best Policy Score</strong>: This method conducts allocations by directly using the policy scores.</p></li>
<li><p><strong>Best Policy Score Classifier</strong>: This method is experimental; soon to be discussed further.</p></li>
</ul>
<section id="policy-allocation-algorithms">
<h2><span class="section-number">1.1. </span>Policy allocation algorithms<a class="headerlink" href="#policy-allocation-algorithms" title="Link to this heading">#</a></h2>
<section id="algorithm-1-policy-tree">
<h3><span class="section-number">1.1.1. </span>Algorithm 1: Policy Tree<a class="headerlink" href="#algorithm-1-policy-tree" title="Link to this heading">#</a></h3>
<p>To opt for this method, set <code class="docutils literal notranslate"><span class="pre">gen_method</span></code> to <code class="docutils literal notranslate"><span class="pre">policy_tree</span></code>.</p>
<p>This method is a tree-search algorithm designed to construct a policy tree.
The implemented policy tree is the optimal tree among all possible trees and is found by looking for the tree that leads to a best performance.
The optimal tree maximises the value function (or welfare), computed as the sum of the individual policy scores, such as potential outcomes or <span class="math notranslate nohighlight">\(IATEs\)</span>, by assigning all observations in a terminal leaf node to a single treatment.
If restrictions are specified, then they are incorporated into treatment specific cost parameters.</p>
<p>While the basic logic follows <a class="reference external" href="https://doi.org/10.1287/opre.2022.2271">Zhou, Athey, and Wager (2022)</a>, the details in the programmatic implementation differ.
For instance, in contrast to the <code class="docutils literal notranslate"><span class="pre">policytree</span></code>, the <code class="docutils literal notranslate"><span class="pre">optpoltree</span></code> option allows to consider constraints regarding the maximal shares of treated observations, treatment costs, and different policy scores.</p>
<p>Let us look into this method further:</p>
<section id="inputs">
<h4><span class="section-number">1.1.1.1. </span>Inputs<a class="headerlink" href="#inputs" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\({(X_i, \hat{\Theta}_i(j))}_{i=1}^{n}\)</span> : A set of observations where <span class="math notranslate nohighlight">\(X_i\)</span> represents the features of the <span class="math notranslate nohighlight">\(i\)</span>-th observation and <span class="math notranslate nohighlight">\(\hat{\Theta}_i(j)\)</span> represents the potential outcome for each observation <span class="math notranslate nohighlight">\(i\)</span> for each treatment <span class="math notranslate nohighlight">\(j\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(L\)</span> : An integer indicating the depth of the tree plus one.</p></li>
<li><p><span class="math notranslate nohighlight">\(p_1\)</span>: The number of ordered features.</p></li>
<li><p><span class="math notranslate nohighlight">\(p_2\)</span> : The number of unordered features.</p></li>
</ul>
</section>
<section id="outputs">
<h4><span class="section-number">1.1.1.2. </span>Outputs<a class="headerlink" href="#outputs" title="Link to this heading">#</a></h4>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mathcal{R}\)</span> : The reward, which is the maximum cumulative potential outcome.</p></li>
<li><p><span class="math notranslate nohighlight">\(\mathcal{T}\)</span> : The policy tree constructed through the algorithm.</p></li>
</ul>
</section>
<section id="purpose">
<h4><span class="section-number">1.1.1.3. </span>Purpose<a class="headerlink" href="#purpose" title="Link to this heading">#</a></h4>
<p>The algorithm aims at constructing a policy tree that maximizes the cumulative potential outcome by selecting the best treatments at each node and splitting the data in a way that optimally partitions it based on the features.
This process is akin to building a decision tree, where each node represents a decision (a split based on a feature) and the leaves represent the final decision (the best treatment).
The goal is to maximize the overall outcome, making the best possible decisions at each step.</p>
</section>
<section id="steps">
<h4><span class="section-number">1.1.1.4. </span>Steps<a class="headerlink" href="#steps" title="Link to this heading">#</a></h4>
<p>Here is a step-by-step explanation on how <code class="docutils literal notranslate"><span class="pre">policy_tree</span></code> works:</p>
<ol class="arabic">
<li><p>Case <span class="math notranslate nohighlight">\(L = 1\)</span>, i.e., no further splits are possible. The algorithm defines the best treatment by summing the potential outcomes for each treatment across all observations and selecting the treatment that maximizes this sum. The algorithm returns this maximum sum of potential outcomes across all treatments and the corresponding treatment.</p></li>
<li><p>Case <span class="math notranslate nohighlight">\(L &gt; 1\)</span>, i.e., further splits are possible. The algorithm initializes the reward <span class="math notranslate nohighlight">\(\mathcal{R}\)</span> to negative infinity and the policy tree <span class="math notranslate nohighlight">\(\mathcal{T}\)</span> to empty. Loop over all features <span class="math notranslate nohighlight">\(X_{m,i}\)</span> where <span class="math notranslate nohighlight">\((m = 1, 2, \ldots, p_1 + p_2)\)</span>:</p>
<dl class="simple">
<dt>For each feature, consider all possible split points:</dt><dd><ul class="simple">
<li><p>Split the data into two sets: left and right, based on the split value.</p></li>
<li><p>Recursively apply the tree search algorithm to both sets, reducing the depth <span class="math notranslate nohighlight">\(L\)</span> by 1.</p></li>
<li><p>Compute the rewards for the left and right splits.</p></li>
<li><p>If the sum of the rewards from the left and right splits exceeds the current maximum reward <span class="math notranslate nohighlight">\(\mathcal{R}\)</span>, update <span class="math notranslate nohighlight">\(\mathcal{R}\)</span> and <span class="math notranslate nohighlight">\(\mathcal{T}\)</span> to reflect the new best split.</p></li>
</ul>
</dd>
<dt>After considering all features and all possible splits, return the best reward and the corresponding policy tree.</dt><dd><p>Essentially, the algorithm explores potential splits of the data by looping over all features.
For each feature, it considers sorted values of ordered features or unique categories of categorical features as potential split points.
For each split point, it divides the data into left and right subsets and applies the tree search recursively on these subsets with depth <span class="math notranslate nohighlight">\(L - 1\)</span>.
The rewards from the left and right recursive calls are summed to determine the effectiveness of the split.
If a new split yields a higher reward than the current best, the algorithm updates the reward and the structure of the policy tree.</p>
</dd>
</dl>
</li>
</ol>
</section>
<section id="example">
<h4><span class="section-number">1.1.1.5. </span>Example<a class="headerlink" href="#example" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mcf.example_data_functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">example_data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mcf.optpolicy_main</span><span class="w"> </span><span class="kn">import</span> <span class="n">OptimalPolicy</span>

<span class="c1"># Generate example data using the built-in function `example_data()`</span>
<span class="n">training_df</span><span class="p">,</span> <span class="n">prediction_df</span><span class="p">,</span> <span class="n">name_dict</span> <span class="o">=</span> <span class="n">example_data</span><span class="p">()</span>

<span class="n">my_policy_tree</span> <span class="o">=</span> <span class="n">OptimalPolicy</span><span class="p">(</span>
    <span class="n">var_d_name</span><span class="o">=</span><span class="s1">&#39;treat&#39;</span><span class="p">,</span>
    <span class="n">var_polscore_name</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y_pot0&#39;</span><span class="p">,</span> <span class="s1">&#39;y_pot1&#39;</span><span class="p">,</span> <span class="s1">&#39;y_pot2&#39;</span><span class="p">],</span>
    <span class="n">var_x_name_ord</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x_cont0&#39;</span><span class="p">,</span> <span class="s1">&#39;x_cont1&#39;</span><span class="p">,</span> <span class="s1">&#39;x_ord1&#39;</span><span class="p">],</span>
    <span class="c1"># Select the Policy Tree method</span>
    <span class="n">gen_method</span><span class="o">=</span><span class="s1">&#39;policy_tree&#39;</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="algorithm-2-best-policy-score">
<h3><span class="section-number">1.1.2. </span>Algorithm 2: Best Policy Score<a class="headerlink" href="#algorithm-2-best-policy-score" title="Link to this heading">#</a></h3>
<p>To opt for this method, set <code class="docutils literal notranslate"><span class="pre">gen_method</span></code> to <code class="docutils literal notranslate"><span class="pre">best_policy_score</span></code>.
Note that this is the <strong>default method</strong>.</p>
<p>This method simply assigns units to the treatment providing it the highest estimated potential outcome.
This algorithm is computationally cheap, but comes with the downside of a low interpretability for the allocation rules.</p>
<section id="id1">
<h4><span class="section-number">1.1.2.1. </span>Example<a class="headerlink" href="#id1" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mcf.example_data_functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">example_data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mcf.optpolicy_main</span><span class="w"> </span><span class="kn">import</span> <span class="n">OptimalPolicy</span>

<span class="c1"># Generate example data using the built-in function `example_data()`</span>
<span class="n">training_df</span><span class="p">,</span> <span class="n">prediction_df</span><span class="p">,</span> <span class="n">name_dict</span> <span class="o">=</span> <span class="n">example_data</span><span class="p">()</span>

<span class="c1"># Create an instance of the OptimalPolicy class:</span>
<span class="n">my_optimal_policy</span> <span class="o">=</span> <span class="n">OptimalPolicy</span><span class="p">(</span>
    <span class="n">var_d_name</span><span class="o">=</span><span class="s1">&#39;treat&#39;</span><span class="p">,</span>
    <span class="n">var_polscore_name</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y_pot0&#39;</span><span class="p">,</span> <span class="s1">&#39;y_pot1&#39;</span><span class="p">,</span> <span class="s1">&#39;y_pot2&#39;</span><span class="p">],</span>
    <span class="n">var_x_name_ord</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x_cont0&#39;</span><span class="p">,</span> <span class="s1">&#39;x_cont1&#39;</span><span class="p">,</span> <span class="s1">&#39;x_ord1&#39;</span><span class="p">],</span>
    <span class="n">var_x_name_unord</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x_unord0&#39;</span><span class="p">],</span>
    <span class="c1"># Select the Best Policy Score method</span>
    <span class="n">gen_method</span><span class="o">=</span><span class="s1">&#39;best_policy_score&#39;</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="algorithm-3-best-policy-score-classifier">
<h3><span class="section-number">1.1.3. </span>Algorithm 3: Best Policy Score Classifier<a class="headerlink" href="#algorithm-3-best-policy-score-classifier" title="Link to this heading">#</a></h3>
<p>To opt for this method, set <code class="docutils literal notranslate"><span class="pre">gen_method</span></code> to <code class="docutils literal notranslate"><span class="pre">bps_classifier</span></code>.</p>
<p>Note that currentlly this is an experimental feature to be discussed soon.</p>
<p>On a high level, this method uses the allocations obtained by the previous Best Policy Score method and trains classifiers.
The output is a decision rule that depends on features only and does not require knowledge about the policy scores.</p>
</section>
</section>
<section id="parameter-tuning-for-the-optimal-policy-tree">
<h2><span class="section-number">1.2. </span>Parameter tuning for the Optimal Policy Tree<a class="headerlink" href="#parameter-tuning-for-the-optimal-policy-tree" title="Link to this heading">#</a></h2>
<p>You can adjust different parameters defined in the <a class="reference internal" href="../python_api.html#optpolicy_main.OptimalPolicy" title="optpolicy_main.OptimalPolicy"><code class="xref py py-class docutils literal notranslate"><span class="pre">OptimalPolicy</span></code></a> class.</p>
<section id="general-parameters">
<h3><span class="section-number">1.2.1. </span>General parameters<a class="headerlink" href="#general-parameters" title="Link to this heading">#</a></h3>
<p>To control how many observations are required at minimum in a partition, you can define such number by using <code class="docutils literal notranslate"><span class="pre">pt_min_leaf_size</span></code>. Leaves that are smaller than <code class="docutils literal notranslate"><span class="pre">pt_min_leaf_size</span></code> in the training data will not be considered. A larger number reduces computation time and avoids overfitting. Default is <span class="math notranslate nohighlight">\(0.1 \times \frac{\text{{number of training observations}}}{\text{{number of leaves}}}\)</span>.</p>
<p>If the number of individuals who receive a specific treatment is constrained, you may specify admissible treatment shares via the keyword argument <code class="docutils literal notranslate"><span class="pre">other_max_shares</span></code>. Note that the information must come as a tuple with as many entries as there are treatments.</p>
<p>When considering treatment costs, input them via <code class="docutils literal notranslate"><span class="pre">other_costs_of_treat</span></code>.  When evaluating the reward, the aggregate costs (costs per unit times units) of the policy allocation are subtracted. If left as default (None), the program determines a cost vector that implies an optimal reward (policy score minus costs) for each individual, while guaranteeing that the restrictions as specified in <code class="docutils literal notranslate"><span class="pre">other_max_shares</span></code> are satisfied. This is only relevant when <code class="docutils literal notranslate"><span class="pre">other_max_shares</span></code> is specified.</p>
<p>Alternatively, if restrictions are present and <code class="docutils literal notranslate"><span class="pre">other_costs_of_treat</span></code> is left to its default, you can specify <code class="docutils literal notranslate"><span class="pre">other_costs_of_treat_mult</span></code>. Admissible values for this parameter are either a scalar greater zero or a tuple with values greater zero. The tuple needs as many entries as there are treatments. The imputed cost vector is then multiplied by this factor.</p>
<div class="pst-scrollable-table-container"><table class="table">
<colgroup>
<col style="width: 25.0%" />
<col style="width: 75.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Keyword</p></th>
<th class="head"><p>Details</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pt_min_leaf_size</span></code></p></td>
<td><p>Minimum leaf size. Leaves that are smaller will not be considered. A larger number reduces computation time and avoids some overfitting. Only relevant if <code class="docutils literal notranslate"><span class="pre">gen_method</span></code> is <code class="docutils literal notranslate"><span class="pre">policy_tree</span></code>. Default is None.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">other_max_shares</span></code></p></td>
<td><p>Maximum share allowed for each treatment. Note that the information must come as a tuple with as many entries as there are treatments. Default is None.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">other_costs_of_treat</span></code></p></td>
<td><p>Treatment specific costs. Subtracted from policy scores. None (when there are no constraints): 0 None (when there are constraints): Costs will be automatically determined such as to enforce constraints in the training data by finding cost values that lead to an allocation (<code class="docutils literal notranslate"><span class="pre">best_policy_score</span></code>) that fulfils restrictions <code class="docutils literal notranslate"><span class="pre">other_max_shares</span></code>. Default is None.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">other_costs_of_treat_mult</span></code></p></td>
<td><p>Multiplier of automatically determined cost values. Use only when automatic costs violate the constraints given by <code class="docutils literal notranslate"><span class="pre">other_max_shares</span></code>. This allows to increase <span class="math notranslate nohighlight">\((&gt;1)\)</span> or decrease <span class="math notranslate nohighlight">\((&lt;1)\)</span> the share of treated in particular treatment. Default is None.</p></td>
</tr>
</tbody>
</table>
</div>
<p>Please consult the <a class="reference internal" href="../python_api.html#mcf_main.ModifiedCausalForest" title="mcf_main.ModifiedCausalForest"><code class="xref py py-class docutils literal notranslate"><span class="pre">API</span></code></a> for more details or additional parameters.</p>
<section id="id2">
<h4><span class="section-number">1.2.1.1. </span>Example<a class="headerlink" href="#id2" title="Link to this heading">#</a></h4>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">mcf.example_data_functions</span><span class="w"> </span><span class="kn">import</span> <span class="n">example_data</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">mcf.optpolicy_main</span><span class="w"> </span><span class="kn">import</span> <span class="n">OptimalPolicy</span>

<span class="c1"># Generate example data using the built-in function `example_data()`</span>
<span class="n">training_df</span><span class="p">,</span> <span class="n">prediction_df</span><span class="p">,</span> <span class="n">name_dict</span> <span class="o">=</span> <span class="n">example_data</span><span class="p">()</span>

<span class="n">my_policy_tree</span> <span class="o">=</span> <span class="n">OptimalPolicy</span><span class="p">(</span>
    <span class="n">var_d_name</span><span class="o">=</span><span class="s1">&#39;treat&#39;</span><span class="p">,</span>
    <span class="n">var_polscore_name</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;y_pot0&#39;</span><span class="p">,</span> <span class="s1">&#39;y_pot1&#39;</span><span class="p">,</span> <span class="s1">&#39;y_pot2&#39;</span><span class="p">],</span>
    <span class="n">var_x_name_ord</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;x_cont0&#39;</span><span class="p">,</span> <span class="s1">&#39;x_cont1&#39;</span><span class="p">,</span> <span class="s1">&#39;x_ord1&#39;</span><span class="p">],</span>
    <span class="n">gen_method</span><span class="o">=</span><span class="s1">&#39;policy_tree&#39;</span><span class="p">,</span>
    <span class="c1"># Minimum leaf size</span>
    <span class="n">pt_min_leaf_size</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="c1"># Maximum share allowed for each treatment (as many elements as treatment (d))</span>
    <span class="n">other_max_shares</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">),</span>
    <span class="c1"># Treatment specific costs</span>
    <span class="n">other_costs_of_treat</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="c1"># Multiplier of automatically determined cost values</span>
    <span class="n">other_costs_of_treat_mult</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span>
</pre></div>
</div>
</section>
</section>
<section id="parameters-for-computational-speed">
<h3><span class="section-number">1.2.2. </span>Parameters for computational speed<a class="headerlink" href="#parameters-for-computational-speed" title="Link to this heading">#</a></h3>
<p>Additionally, you can control certain aspects of the algorithm which impact running time:</p>
<ul class="simple">
<li><p><strong>Tree Depth</strong>: You can specify the depth of the trees via the keyword arguments <code class="docutils literal notranslate"><span class="pre">pt_depth_tree_1</span></code> and <code class="docutils literal notranslate"><span class="pre">pt_depth_tree_2</span></code>.</p>
<ul>
<li><p><code class="docutils literal notranslate"><span class="pre">pt_depth_tree_1</span></code> defines the depth of the first optimal tree. The default is 3. Tree depth is defined such that a depth of 1 implies 2 leaves, a depth of 2 implies 4 leaves, a depth of 3 implies 8 leaves, etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pt_depth_tree_2</span></code> defines the depth of the second optimal tree, which builds upon the strata obtained from the leaves of the first tree. If <code class="docutils literal notranslate"><span class="pre">pt_depth_tree_2</span></code> is set to 0, the second tree is not built. The default is 1. Together with the default for <code class="docutils literal notranslate"><span class="pre">pt_depth_tree_1</span></code>, this leads to a total tree of depth 4 (which is not optimal). Tree depth is defined in the same way as for <code class="docutils literal notranslate"><span class="pre">pt_depth_tree_1</span></code>.</p></li>
</ul>
</li>
<li><p><strong>Number of Evaluation Points</strong>: <code class="docutils literal notranslate"><span class="pre">pt_no_of_evalupoints</span></code> parameter specifies the number of evaluation points for continuous variables during the tree search. It determines how many of the possible splits in the feature space are considered. If the value of <code class="docutils literal notranslate"><span class="pre">pt_no_of_evalupoints</span></code> is smaller than the number of distinct values of a certain feature, the algorithm visits fewer splits, thus increasing computational efficiency. However, a lower value may also deviate more from the optimal splitting rule. This parameter is closely related to the approximation parameter of <a class="reference external" href="https://doi.org/10.1287/opre.2022.2271">Zhou, Athey, and Wager (2022)</a> . This parameter is only relevant if <code class="docutils literal notranslate"><span class="pre">gen_method</span></code> is <code class="docutils literal notranslate"><span class="pre">policy_tree</span></code>. The default value (or None) is 100.</p></li>
</ul>
<div class="pst-scrollable-table-container"><table class="table">
<colgroup>
<col style="width: 30.0%" />
<col style="width: 70.0%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Keyword</p></th>
<th class="head"><p>Details</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pt_depth_tree_1</span></code></p></td>
<td><p>Depth of 1st optimal tree. Default is 3.</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">pt_depth_tree_2</span></code></p></td>
<td><p>Depth of 2nd optimal tree. Default is 1.</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">pt_no_of_evalupoints</span></code></p></td>
<td><p>Number of evaluation points for continous variables. Default is 100.</p></td>
</tr>
</tbody>
</table>
</div>
</section>
</section>
</section>


                </article>
              
              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="QIATEs.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title"><span class="section-number">5. </span>QIATEs</p>
      </div>
    </a>
    <a class="right-next"
       href="fairscores.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title"><span class="section-number">2. </span>Fairness Extensions in Optimal Policy</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
<div
    id="pst-page-navigation-heading-2"
    class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc" aria-labelledby="pst-page-navigation-heading-2">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#policy-allocation-algorithms">1.1. Policy allocation algorithms</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#algorithm-1-policy-tree">1.1.1. Algorithm 1: Policy Tree</a><ul class="visible nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#inputs">1.1.1.1. Inputs</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#outputs">1.1.1.2. Outputs</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#purpose">1.1.1.3. Purpose</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#steps">1.1.1.4. Steps</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#example">1.1.1.5. Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#algorithm-2-best-policy-score">1.1.2. Algorithm 2: Best Policy Score</a><ul class="visible nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id1">1.1.2.1. Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#algorithm-3-best-policy-score-classifier">1.1.3. Algorithm 3: Best Policy Score Classifier</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-tuning-for-the-optimal-policy-tree">1.2. Parameter tuning for the Optimal Policy Tree</a><ul class="visible nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#general-parameters">1.2.1. General parameters</a><ul class="visible nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#id2">1.2.1.1. Example</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameters-for-computational-speed">1.2.2. Parameters for computational speed</a></li>
</ul>
</li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/algorithm_reference/optimal-policy_algorithm.rst.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">

  <p class="copyright">
    
      Â© Copyright 2024, Michael Lechner.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">

  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 8.2.3.
    <br/>
  </p>
</div>
      
    </div>
  
  
  
    <div class="footer-items__end">
      
        <div class="footer-item">
<p class="theme-version">
  <!-- # L10n: Setting the PST URL as an argument as this does not need to be localized -->
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.16.1.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>